# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
## Данные и типы данных, используемые в приложении

Интерфейс карточки товара

```
interface ICard {
    id: string,
    description: string,
    image: string,
    title: string,
    category: string,
    price: number | null,
}
```
Интерфейс данных пользователя

```
interface IUserData {
    payment: TPayment,
    address: string,
    email: string,
    phone: string,
}
```

Интерфейс данных карточек

```
interface ICardsData {
    cards: ICard[],
    getCard(cardId: string): ICard,
}
```

Интерфейс данных корзины

```
interface IBasket {
    cards: ICard[],
    addCard(card: ICard): void,
    deleteCard(cardId: string): void,
    getCount(): number,
    getTotalPrice(): number | null,
    inBasket(cardId: string): boolean,
    clearBasket(): void,
}
```

Интерфейс отображения карточек
```
interface ICardView extends ICard{
    cardIndex: number;
    checkBasket: boolean;
}
```

Интерфейс отображения главной страницы
```
interface IAppView {
    catalog: HTMLElement[];
    countInBasket: number;
}
```

Интерфейс отображения корзины
```
interface IBasketView {
    cards: HTMLElement[],
    totalPrice: number,
}
```

Интерфейс отображения форм
```
interface IFormView {
    formName: string,
    errors: string,
}
```

Интерфейс отображения модального окна
```
interface IModal {
    content: HTMLElement;
}
```

Интерфейс отображения окна успешной покупки
```
interface ISuccess {
    totalPrice:number
}
```


Данные способа оплаты
```
type TPayment = 'cash' | 'card'
```

Тип и интерфейсы API
```
type ApiPostMethods = 'POST' | 'PUT' | 'DELETE' | 'PATCH'
```
```
interface IUserResponse {
    id: string,
    total: number,
    error: string,
}
```
```
interface IApi {
    baseUrl: string,
    get<T>(uri:string): Promise<T>,
    post<T>(uri: string, data: object, method?: ApiPostMethods): Promise<T>,
}
```

Категории карточек
```
type TCategory = 'софт-скил' | 'хард-скил' | 'другое' | 'кнопка' | 'дополнительное'
```

## Архитектура приложения

Код приложения разделен на слои согласно шаблону проектирования MVP:
- слой данных отвечает за хранение и изменение данных,
- слой представления отвечает за отображение данных на странице,
- презентер отвечает за связь представления и данных.

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов на сервер. В конструктор передается базовый адрес сервера и объект опций с заголовками запросов.
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс Component
Данный абстрактный класс является базовым для всех классов представления.\
- `constructor(container: HTMLElement)` - в конструктор передается элемент разметки.

Методы класса:
- `render(data?: Partial<T>): HTMLElement` - принимает данные, которые потом отображает в разметке
- `isDisabled(element: HTMLElement, isDisabled: boolean)` - реализует состояние активности передаваемого элемента

#### Класс FormView
Данный класс расширяет класс `Component` и является базовым для всех классов отображения форм в приложении. Инициируется событие сабмита. При изменении данных в полях ввода инициирует событие изменения данных, передавая в него объект с данными из полей ввода формы.\ 
- `constructor(container: HTMLFormElement, events: IEvents)` -  конструктор передается элемент разметки карточки и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса:
- `formName: string` - имя формы
- `submitButton: HTMLButtonElement` - кнопка сабмита формы
- `error: HTMLElement` - поле вывода ошибок
- `events: IEvents` - инстанс класса `EventEmitter` для инициации событий при изменениях данных

Методы класса:
- `сеттеры` - для сохранения значений полей класса.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Методы класса:
- `on` - установить обработчик на событие
- `off` - снять обработчик с события
- `emit` - инициализация события
- `onAll` - слушать все события
- `onOff` - снять все обработчики
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие   

### Слой данных

#### Класс UserData
Данный класс отвечает за логику работы с данными пользователя.\
- `constructor(events: IEvents)` - конструктор принимает экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса:
- `payment: TPayment` - выбор способа оплаты
- `address: string` - адресс доставки
- `email: string` - электронная почта пользователя
- `phone: string` - телефон пользователя
- `events: IEvents` - инстанс класса `EventEmitter` для инициации событий при изменениях данных

Методы класса:
- `orderValidation()` - проверяет поля формы выбора оплаты и адреса доставки на валидность и инициирует событие при изменении данных
- `contactsValidation()` - проверяет поля формы контактных данных на валидность и инициирует событие при изменении данных
- `setUserData<T extends keyof IUserData>(field: T, value: IUserData[T])` - сохраняет данные пользователя
- `getUserData(): void` - возвращает данные пользователя
- `сеттеры и геттеры` для сохранения и получения значений полей класса

#### Класс BasketData
Данный класс отвечает за хранение и логику работы с данными карточек в корзине.\
- `constructor(events: IEvents)` - конструктор принимает экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса:
- `cards: ICard[]` - список карточек, добавленных в корзину
- `events: IEvents` - инстанс класса `EventEmitter` для инициации событий при изменениях данных

Методы класса:
- `addCard(card: ICard)` - добавляет в корзину одну карточку в конец массива и вызывает событие изменения массива
- `deleteCard(cardId: string)` - удаляет из массива карточку и вызывает событие изменения массива
- `getCount()` - вычисляет количество карточек в корзине
- `getTotalPrice()` - вычисляет стоимость всех карточек в корзине
- `inBasket(cardId: string)` - проверяет наличие товара в корзине по ID
- `clearBasket()` - очищает корзину и вызывает событие изменения массива
- `геттер` - для получения списка карточек

#### Класс CardsData
Данный класс отвечает за хранение и логику работы с данными карточек на главной странице. Также инициирует событие при сохранении карточек, полученных с сервера.\
- `constructor(events: IEvents)` - конструктор принимает экземпляр класса `EventEmitter` для возможности инициации событий.

В полях класса хранятся следующие данные:
- `cards: ICard[]` - список карточек на главной странице
- `events: IEvents` - инстанс класса `EventEmitter` для инициации событий при изменениях данных

Так же класс предоставляет метод для взаимодействия с этими данными:
- `getCard(cardId: string)` - возвращает карточку по её id
- `сеттеры и геттеры` для сохранения и получения значений полей класса


### Слой представления
В этом слое все классы отвечают за отображение DOM-элементов передаваемых в них данных.

#### Класс AppView
Данный класс реализует отображение главной страницы приложения со списком карточек и корзины. Также инициирует событие при клике на корзину.\
- `constructor(container: HTMLElement, events: IEvents)` - конструктор принимает элемент разметки, по которому в разметке страницы будет идентифицирована главная страница и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса:
- `catalog: HTMLElement` - каталог карточек
- `basketCounter: HTMLElement` - счётчик карточек в корзине
- `basketButton: HTMLElement` - элемент корзины
- `wrapper: HTMLElement` - скролл на главной страницк
- `events: IEvents` - инстанс класса `EventEmitter` для инициации событий при изменениях данных

Методы класса:
- `сеттеры` - для сохранения значений полей класса

#### Класс CardView
Данный класс расширяет класс `Component` и является родительским для всех классов отображения карточек.\ 
- `constructor(container: HTMLElement, events: IEvents)` - в конструктор передается элемент разметки карточки и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса:
- `id: string` - идентификатор карточки
- `title: HTMLElement` - заголовок карточки
- `price: HTMLElement` - цена карточки
- `events: IEvents` - инстанс класса `EventEmitter` для инициации событий при изменениях данных

Методы класса:
- `сеттеры` - для сохранения значений полей класса.

#### CardBasket
Данный класс расширяет класс `CardView` и реализует отображение карточки в корзине. Конструктор принимает элемент разметки, по которому в разметке страницы будет идентифицирована карточка и экземпляр класса `EventEmitter` для возможности инициации событий. Так же класс инициирует событие удаления карточки при нажатии на соответствующую кнопку.

Поля класса:
- `cardIndex: HTMLElement` - индекс карточки
- `deleteButton: HTMLButtonElement` - кнопка удаления из корзины

Методы класса:
- `сеттер` - для сохранения значений полей класса.

#### CardCatalog
Данный класс расширяет класс `CardView` и реализует отображение карточки в каталоге главной страницы. Конструктор принимает элемент разметки, по которому в разметке страницы будет идентифицирована карточка и экземпляр класса `EventEmitter` для возможности инициации событий. Так же класс инициирует событие открытия карточки в режиме предпросмотра при нажатии на саму карточку.

Поля класса:
- `category: HTMLElement` - категория
- `cardImage: HTMLImageElement` - изображение карточки

Методы класса:
- `сеттеры` - для сохранения значений полей класса.

#### CardPreview
Данный класс расширяет класс `CardView` и реализует отображение карточки в режиме предпросмотра с подробным описанием. Конструктор принимает элемент разметки, по которому в разметке страницы будет идентифицирована карточка и экземпляр класса `EventEmitter` для возможности инициации событий. Так же класс инициирует событие добавления карточки в корзину при нажатии на кнопку "Купить".

Поля класса:
- `category: HTMLElement` - категория
- `cardImage: HTMLImageElement` - изображение карточки
- `description: HTMLElement` - описание карточки
- `addButton: HTMLButtonElement` - кнопка добавления в корзину

Методы класса:
- `сеттеры` - для сохранения значений полей класса.

#### Класс Modal
Данный класс расширяет класс `Component` и релизует отображение модального окна. В нём рендерятся любые разметки, передаваемые в поле `сontent`. Предоставляет методы `open()` и `close()` для управления отображением модального окна. Так же класс устанавливает слушатели событий на клавиатуру для закрытия модального окна кликом на оверлей и на кнопку-крестик.
- `constructor(container: HTMLElement, events: IEvents)` - конструктор принимает селектор, по которому в разметке страницы будет идентифицировано модальное окно и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса:
- `content: HTMLElement` - разметка контента
- `closeButton: HTMLButtonElement` - кнопка закрытия модального окна
- `events: IEvents` - инстанс класса `EventEmitter` для инициации событий при изменениях данных

Методы класса:
- `handleEscUp(evt: KeyboardEvent)` - реализует закрытие модального окна по кнопке Escape

#### Класс ContactsForm
Данный класс расширяет класс `FormView` и реализует отображение формы с полями для контактных данных.\
- `constructor(container: HTMLFormElement, events: IEvents)` - конструктор принимает селектор, по которому в разметке страницы будет идентифицирована форма контактов и экземпляр класса `EventEmitter` для возможности инициации событий.
Поля класса:
- `email: HTMLInputElement` - инпут для электронной почты
- `phone: HTMLInputElement` - инпут для номера телефона

Методы класса:
- `сеттеры` - для сохранения значений полей класса

#### Класс OrderForm
Данный класс расширяет класс `FormView` и реализует отображение формы с полем ввода адреса и выбором способа оплаты. При выборе способа оплаты инициируются события передавая в них объект с данными способа оплаты.\
- `constructor(container: HTMLFormElement, events: IEvents)` - конструктор принимает селектор, по которому в разметке страницы будет идентифицирована форма контактов и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса:
- `address: HTMLInputElement` - инпут для адресса доставки
- `cashButton: HTMLButtonElement` - кнопка способа оплаты "При получении"
- `cardButton: HTMLButtonElement` - кнопка способа оплаты "Онлайн"

Методы класса:
- `сеттеры` - для сохранения значений полей класса

#### Класс SuccessOrderView
Данный класс реализует окно с успешным результатом заказа. При сабмите иницирует событие и закрывает модальное окно.\
- `constructor(container: HTMLElement, events: IEvents)` - конструктор принимает селектор, по которому в разметке страницы будет идентифицировано окно результата заказа и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса:
- `title: HTMLElement` - заголовок окна
- `description: HTMLElement` - элемент с суммой заказа
- `button: HTMLButtonElement` - кнопка возврата на главную страницу
- `events: IEvents` - инстанс класса `EventEmitter` для инициации событий при изменениях данных

Методы класса:
- `set totalPrice(value: number)` - сеттер общей суммы карточек

#### Класс BasketView
Данный класс отображает содержимое корзины. При сабмите иницирует событие перехода к следующему шагу.\
- `constructor(container: HTMLElement, events: IEvents)` - конструктор принимает селектор, по которому в разметке страницы будет идентифицирована разметка корзины и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса:
- `cardsContainer: HTMLElement` - контейнер для карточек
- `orderButton: HTMLButtonElement` - кнопка перехода к следующему шагу
- `totalPrice: number` - общая сумма всех карточек
- `events: IEvents` - инстанс класса `EventEmitter` для инициации событий при изменениях данных

Методы класса:
- `сеттеры` для сохранения значений полей класса


### Слой коммуникации

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с сервером.

Методы класса:
- `getCatalog(): Promise<ICard[]>` - получаем массив карточек с сервера
- `postUserData(cards: ICard[], data: IUserData, orderPrice: number): Promise<IUserResponse>` - отправляем на сервер карточки из корзины и  данные пользователя из полей форм


## Взаимодействие компонентов
Код, описывающий взаимодействие слоёв представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\

Список событий, которые могут генерироваться в системе (генерируются классами моделями данных):
- `cards:loaded` - получение карточек с сервера
- `order:data_changed` - изменение данных пользователя в форме заказа
- `contacts:data_changed` - изменение данных пользователя в форме для контактных данных
- `basket:changed` - изменения в корзине при добавлении, удалении карточек и очистки корзины

События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами представления):
- `basket:open` - открытие модального окна корзины
- `basket:to_Order` - переход к модальному окну с формой заказа
- `order:change` - изменение данных в форме заказа
- `order:data_changed` - рендер при изменении данных формы заказа
- `contacts:change` - изменение данных в форме контактных данных
- `contacts:data_changed` - рендер при изменении данных формы контактных данных
- `order:submit` - событие перехода к следующей форме контактных данных
- `contacts:submit` - событие отправки данных на сервер и перехода к окну с успешной оплатой
- `card:select` - открытие карточки в модальном окне с подробным описанием 
- `card:add` - добавление карточки в корзину
- `card:delete` - выбор карточки для удаления из корзины
- `success:submit` - возвращение на главную страницу из окна успешной оплаты
- `modal:scrolled` - управление состоянием скролла


