# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
## Данные и типы данных, используемые в приложении

Интерфейс карточки товара

```
interface ICard {
    id: string;
    description: string;
    image: string;
    title: string;
    category: string;
    price: number | null;
}
```
Интерфейс данных пользователя

```
interface IUserData {
    payment: string;
    address: string;
    email: string;
    phone: number;
}
```

Интерфейс для данных карточек

```
interface ICardsData {
    container: ICard[];
    preview: string | null;
}
```

Интерфейс для корзины

```
interface IBasket {
    cards: TBasketItem[];
    cardIndex: number | null;
    counter: number;
    totalPrice: number | null;
}
```

Данные для карточки в корзине
```
type TBasketItem = Pick<ICard, 'title' | 'price'>
```

Данные способа оплаты
```
type TPayment = 'online' | 'personally'
```

Данные для валидации полей
```
type TFormValidation = Pick<IUserData, 'address' | 'email' | 'phone'>
```

## Архитектура приложения

Код приложения разделен на слои согласно шаблону проектирования MVP:
- слой данных отвечает за хранение и изменение данных,
- слой представления отвечает за отображение данных на странице,
- презентер отвечает за связь представления и данных.

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов на сервер. В конструктор передается базовый адрес сервера и объект опций с заголовками запросов.
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Методы, реализуемые классом:
- `on` - установить обработчик на событие
- `off` - снять обработчик с события
- `emit` - инициализация события
- `onAll` - слушать все события
- `onOff` - снять все обработчики
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие   

### Слой данных

#### Класс UserData
Класс отвечает за логику работы с данными пользователя.\
- `constructor(events: IEvents)` - конструктор принимает экземпляр класса `EventEmitter` для возможности инициации событий.

В полях класса хранятся следующие данные:
- `payment: TPayment` - выбор способа оплаты
- `address: string` - адресс доставки
- `email: string` - электронная почта пользователя
- `phone: number` - телефон пользователя
- `events: IEvents` - инстанс класса `EventEmitter` для инициации событий при изменениях данных

Так же класс предоставляет метод для взаимодействия с этими данными:
- `checkValidation(data: Record<keyof TFormValidation, string>): boolean` - проверяет объект с данными пользователя на валидность
- `сеттеры` для сохранения значений полей класса

#### Класс Basket
Класс отвечает за хранение и логику работы с данными карточек в корзине.\
- `constructor(events: IEvents)` - конструктор принимает экземпляр класса `EventEmitter` для возможности инициации событий.

В полях класса хранятся следующие данные:
- `cards: TBasketItem[]` - список карточек, добавленных в корзину
- `cardIndex: number | null` - порядковый номер карточки в корзине
- `counter: number` - количество карточек в корзине
- `totalPrice: number | null` - общая сумма всех карточек в корзине
- `events: IEvents` - инстанс класса `EventEmitter` для инициации событий при изменениях данных

Так же класс предоставляет набор методов для взаимодействия с этими данными:
- `addCard(card: ICard): void` - добавляет в корзину одну карточку в конец массива и вызывает событие изменения массива
- `updateBasket(card: ICard): void` - обновляет массив карточек в корзине. 
- `deleteCard(cardId: string): void` - удаляет из массива карточку и вызывает событие изменения массива
- `сеттеры и геттеры` для сохранения и получения значений полей класса

#### Класс CardsData
Класс отвечает за хранение и логику работы с данными карточек на главной странице.\
- `constructor(events: IEvents)` - конструктор принимает экземпляр класса `EventEmitter` для возможности инициации событий.

В полях класса хранятся следующие данные:
- `cards: ICard[]` - список карточек на глвной странице
- `preview: string | null` - карточка в попапе с детализацией
- `events: IEvents` - инстанс класса `EventEmitter` для инициации событий при изменениях данных

Так же класс предоставляет метод для взаимодействия с этими данными:
- `getCard(cardId: string): ICard` - возвращает карточку по её id

### Слой представления
В этом слое все классы отвечают за отображение DOM-элементов передаваемых в них данных.

#### Класс Modal
Данный класс релизует модальное окно. Предоставляет методы `open` и `close` для управления отображением модального окна. Так же класс устанавливает слушатели событий на клавиатуру для закрытия модального окна кликом на оверлей и на кнопку-крестик.
- `constructor(selector: string, events: IEvents)` - конструктор принимает селектор, по которому в разметке страницы будет идентифицировано модальное окно и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса:
- `modal: HTMLElement` - карточка в попапе с детализацией
- `events: IEvents` - инстанс класса `EventEmitter` для инициации событий при изменениях данных

Методы класса:
- `get form: HTMLElement` - геттер для получения элемента формы

#### Класс ModalBasket
Данный класс расширяет класс Modal. Предназначен для реализации модального окна содержащей корзину с массивом карточек. При удалении карточки инициирует событие изменения данных. Предоставляет методы для управления активностью кнопки перехода.

Поля класса:
- `form: HTMLFormElement` - элемент формы
- `formName: string` - значение атрибута name формы
- `nextButton: HTMLButtonElement` - кнопка перехода к следующему шагу
- `cards: NodeListOf<HTMLElement>` - коллекция всех карточек
- `index: HTMLElement` - индекс карточки в корзине
- `totalPrice: HTMLElement` - общую сумму всех карточек

Методы класса:
- `setValid(isValid: boolean): void` - изменяет активность кнопки подтверждения

#### Класс ModalForm
Данный класс расширяет класс Modal. Предназначен для реализации модального окна с формой содержащей поля ввода. При сабмите инициирует событие передавая в него объект с данными из полей ввода формы. При изменении данных в полях ввода инициирует событие изменения данных. Предоставляет методы для отображения ошибок и управления активностью кнопки подтверждения.\
Поля класса:
- `form: HTMLFormElement` - элемент формы
- `formName: string` - значение атрибута name формы
- `nextButton: HTMLButtonElement` - кнопка перехода к следующему шагу
- `inputs: NodeListOf<HTMLInputElement>` - коллекция всех полей ввода формы
- `errors: Record<string, HTMLElement>` - объект хранящий все элементы для вывода ошибок под полями формы с привязкой к атрибуту name инпутов

Методы класса:
- `setValid(isValid: boolean): void` - изменяет активность кнопки кнопки перехода к следующему шагу
- `setInputValues(data: Record<string, string>): void` - принимает объект с данными для заполнения полей формы
- `setError(data: { field: string, value: string, validInformation: string }): void` - принимает объект с данными для отображения или сокрытия текста ошибок под полями ввода
- `showInputError (field: string, errorMessage: string): void` - отображает полученный текст ошибки под полями ввода
- `hideInputError (field: string): void` - очищает текст ошибки под полями ввода


#### Класс ModalConfirm
Данный класс расширяет класс Modal. Предназначен для реализации модального окна подтверждения.

Поля класса:
- `form: HTMLFormElement` - элемент формы
- `formName: string` - значение атрибута name формы
- `submitButton: HTMLButtonElement` - кнопка подтверждения

#### Класс CardsData
Отвечает за отображение блока с карточками на главной странице. Предоставляет сеттер `container` для отображения содержимого. В конструктор принимает контейнер, в котором размещаются карточки.

### Слой коммуникации

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с сервером.


## Взаимодействие компонентов
Код, описывающий взаимодействие слоёв представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\

Список событий, которые могут генерироваться в системе (генерируются классами моделями данных):
- `cards:changed` - изменение массива карточек
- `card:selected` - изменение открываемой в модальном окне карточки

События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами представления):
- `basket:open` - открытие модального окна корзины
- `order:open` - открытие модального окна с формой выбора способа оплаты и указанием адреса
- `contacts:open` - открытие модального окна c формой заполнения контактных данных
- `order-success:open` - открытие модального окна с попапом успешной оплаты
- `card:select` - выбор карточки для отображения в модальном окне
- `card:delete` - выбор карточки для удаления из корзины
- `orderForm:input` - изменение данных в форме выбора способа оплаты и указания адреса
- `contactsForm:input` - изменение данных в форме с указанием контактов
- `remove-card:submit` - событие, генерируемое при нажатии иконки удаления в корзине
- `edit-profile:validation` - событие, сообщающее о необходимости валидации формы профиля


